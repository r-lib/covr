box: rocker/r-devel
build:
  steps:
  - script:
    name: cran dependencies
    code: |
      export R_LIBS=$WERCKER_CACHE_DIR/R/library
      ls $R_LIBS
      mkdir -p $R_LIBS
      Rscript -e 'install.packages("devtools")'\
              -e 'devtools::install_deps(dependencies = TRUE)'
  - script:
    name: github dependencies
    code: |
      Rscript -e 'devtools::install_github("jimhester/lintr")'\
              -e 'devtools::install_github("hadley/testthat")'\
              -e 'devtools::install_github("kevinushey/rex")'\
              -e 'devtools::install_github("jimhester/robustr")'
  - script:
    name: check
    code: Rscript -e 'devtools::check(document = FALSE, cleanup = FALSE)'
  after-steps:
  - script:
    name: dump_logs
    cwd: $WERCKER_ROOT
    code: |
      if [ "$WERCKER_RESULT" != "passed" ]; then
        pwd
        ls
        for name in $(find *.Rcheck -type f -name "*out" -o -name "*log" -o -name "*fail"); do
            echo ">>> File: ${name} <<<"
            cat $name
          done
      fi
